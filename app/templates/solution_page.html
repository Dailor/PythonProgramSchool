{% extends "base.html" %}
{% block title %}{{task.name}}{% endblock %}

{% block style %}
<link rel="stylesheet" href="{{url_for('static', filename='vendor/codemirror/lib/codemirror.css')}}">
<link rel="stylesheet" href="{{url_for('static', filename='vendor/codemirror/theme/neat.css')}}">
<link href="{{url_for('static', filename='css/lessons_available.css')}}" rel="stylesheet">
{% endblock %}

{% block javascript %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>

<script src="{{url_for('static', filename='vendor/codemirror/lib/codemirror.js')}}"></script>
<script src="{{url_for('static', filename='vendor/codemirror/mode/python/python.js')}}"></script>
<!--<script src="{{url_for('static', filename='vendor/codemirror/mode/clike/clike.js')}}"></script>-->

<script>
const pupil_id = {{pupil_id}};
const task_id = {{task.id}};
const group_id = {{group_id}};
const is_teacher = {{ ('true' if current_user.is_teacher else 'false')|safe}};




</script>

<script src="{{url_for('static', filename='js/task_solution.js', version=STATIC_FILES_VERSION)}}"></script>

{% if current_user.is_pupil %}
<script src="{{url_for('static', filename='js/pupil/task_solution.js', version=STATIC_FILES_VERSION)}}"></script>
{% else %}
<script src="{{url_for('static', filename='js/teacher/task_solution.js', version=STATIC_FILES_VERSION)}}"></script>
{% endif %}

{% endblock %}

{% block content %}
<div class="card shadow">
    <div class="card-header"><h3 id="taskName" class="m-0 font-weight-bold text-info">{{task.name}}</h3>
    </div>
    <div class="card-body">
        <div>
            <div>
                <div>
                    <h4>Ограничения</h4>
                    <h6>Память: <span id="memoryLimit">{{task.memory_mb}}</span> мегабайт</h6>
                    <h6>Время: <span id="timeLimit">{{task.time_sec}}</span> секунд</h6>
                </div>
                <div>
                    <h4>Описание</h4>
                    <p class="my-2" id="taskDescription">{{task.description|safe}}</p>
                </div>
                <div class="my-4">
                    <h4>Примеры: </h4>
                    <table border="1" class="w-100">
                        <thead>
                        <tr>
                            <th class="w-50">Входные данные</th>
                            <th class="w-50">Выходные данные</th>
                        </tr>
                        </thead>
                        <tbody id="dataExamples">
                        {% for example in task.examples %}
                        <tr class="rowExample">
                            <td>{{example['in_data']}}</td>
                            <td>{{example['out_data']}}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-6">
                    <h4>Решение</h4>
                    <div class="mr-2 mt-2" id="codeMirror"></div>


                </div>
                <div class="col-6">
                    <h4>История решений</h4>
                    <div class="table-responsive table-bordered solutions-history">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th scope="col">Попытка</th>
                                <th scope="col">Дата</th>
                                <th scope="col">Статус</th>
                            </tr>
                            </thead>
                            <tbody id="solutions">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div>
                {% if current_user.is_teacher %}
                <h4 class="my-4">Отправил: {{pupil_full_name}}</h4>
                {% endif %}
                <p>Осталось попыток: <span id="tries-left"></span></p>
            </div>
            <div>
                {% if current_user.is_pupil %}
                <button id="sendSolution" class="btn btn-primary" onclick="send_solution()">Отправить
                </button>
                {% else %}
                <div>
                    <button id="acceptSolution" class="btn btn-success my-3" onclick="acceptSolution()" disabled>
                        Принять
                    </button>
                    <button id="declineSolution" class="btn btn-danger my-3" onclick="declineSolution()" disabled>
                        Отклонить
                    </button>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="modal fade" id="solutionInfo" tabindex="-1" role="dialog"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Информация о решении</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-solution-info">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}